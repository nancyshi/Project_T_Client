{"version":3,"sources":["../../../../../assets/scripts/towerDefens/assets/scripts/towerDefens/resMgr.js"],"names":["cc","Class","extends","Component","properties","isAllResesLoaded","get","_isAllResesLoaded","set","value","log","target","onAllResesLoaded","resesToLoad","resesNum","_resesNum","loadedResesNum","_loadedResesNum","reses","_reses","monstors","towers","onLoad","start","loadNeededReses","waveConfig","node","parent","getChildByName","getComponent","json","monstorIds","k","element","index","monstorObj","monstorId","some","x","push","monstorConfig","require","monstorPrefabNames","id","prefabName","towerPrefabNames","Object","keys","length","key","url","loader","loadRes","err","res"],"mappings":"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","file":"resMgr.js","sourceRoot":"../../../../../assets/scripts/towerDefens","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        isAllResesLoaded: {\n            get() {\n                return this._isAllResesLoaded\n            },\n            set(value) {\n                this._isAllResesLoaded = value\n                if (value == true) {\n                    cc.log(\"COMPLET\")\n                    if(this.target == null) {\n                        return\n                    }\n                    this.target.onAllResesLoaded()\n                }\n            }\n        },\n        resesToLoad: null,\n        resesNum: {\n            get() {\n                return this._resesNum\n            },\n            set(value) {\n                this._resesNum = value\n            }\n        },\n        loadedResesNum: {\n            get() {\n                return this._loadedResesNum\n            },\n            set(value) {\n                this._loadedResesNum = value\n                if (value == this.resesNum) {\n                    this.isAllResesLoaded = true\n                }\n            }\n        },\n        reses: {\n            get() {\n                if (this._reses == null) {\n                    this._reses = {\n                        monstors: {},\n                        towers: {}\n                    }\n                }\n                return this._reses\n            },\n            set(value) {\n                this._reses = value\n            }\n        },\n        target: null\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n\n    },\n\n    start () {\n    },\n\n    loadNeededReses() {\n        var waveConfig = this.node.parent.getChildByName(\"gameMgrNode\").getComponent(\"gameMgr\").waveConfig.json\n        var monstorIds = []\n        for (var k in waveConfig) {\n            var element = waveConfig[k]\n            for (var index in element) {\n                var monstorObj = element[index]\n                var monstorId = monstorObj.monstorId\n                if (monstorIds.some(function(x){\n                    return x == monstorId\n                }) == false){\n                    monstorIds.push(monstorId)\n                }\n            }\n        }\n\n        var monstorConfig = require(\"monstorConfig\")\n        var monstorPrefabNames = {}\n        for (var index in monstorIds) {\n            var id = monstorIds[index]\n            var prefabName = monstorConfig[id].prefabName\n            monstorPrefabNames[id] = prefabName\n        }\n\n        var towerPrefabNames = {\n            \"20001\": \"acherTow_101_01\"\n        }\n\n        this.resesNum = Object.keys(monstorPrefabNames).length + Object.keys(towerPrefabNames).length\n        this.loadedResesNum = 0\n\n        for(var key in monstorPrefabNames) {\n            (function(key,target){\n                var prefabName = monstorPrefabNames[key]\n                var url = \"prefabs/monstors/\" + prefabName\n                cc.loader.loadRes(url,function(err,res){\n                    cc.log(target.reses)\n                    target.reses.monstors[key] = res\n                    target.loadedResesNum += 1\n                })\n            })(key,this)\n        }\n\n        for(var key in towerPrefabNames) {\n            (function(key,target){\n                var prefabName = towerPrefabNames[key]\n                var url = \"prefabs/towers/\" + prefabName\n                cc.loader.loadRes(url,function(err,res){\n                    target.reses.towers[key] = res\n                    target.loadedResesNum += 1\n                })\n            })(key,this)\n        }\n\n    },\n\n    \n\n    \n\n    // update (dt) {},\n});\n"]}