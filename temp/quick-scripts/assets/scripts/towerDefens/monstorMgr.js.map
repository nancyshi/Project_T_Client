{"version":3,"sources":["monstorMgr.js"],"names":["cc","Class","extends","Component","properties","basePathPoints","state","get","_state","set","value","onReachFinalTarget","onDie","maxHealth","_maxHeath","processBar","node","getChildByName","getComponent","ProgressBar","progress","health","_heath","isHeathBarHidden","_isHeathBarHidden","heathBarNode","active","moveSpeed","target","vx","vy","targetIndex","onLoad","start","x","y","t","getDisOfTwoPoint","position","update","dt","nextX","nextY","length","calculatePathPoints","p1","p2","temp","Math","sqrt","removeFromParent","mapMgr","find","index","monstors","splice","getHurt","hurtNum"],"mappings":"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","file":"monstorMgr.js","sourceRoot":"../../../../../assets/scripts/towerDefens","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        basePathPoints: [],\n        state: {\n            get() {\n                return this._state\n            },\n            set(value) {\n                this._state = value\n                if (value == 2) {\n                    this.onReachFinalTarget()\n                }\n                if (value == 3) {\n                    this.onDie()\n                }\n            }\n        //STATE ENUM\n        //0 default , do nothing\n        //1 go to target\n        //2 reach final target\n        //3 die\n        },\n        maxHealth: {\n            get() {\n                if (this._maxHeath == null) {\n                    this._maxHeath = 100\n                    return this._maxHeath\n                }\n                else {\n                    return this._maxHeath\n                }\n            },\n            set(value) {\n                this._maxHeath = value\n                var processBar = this.node.getChildByName(\"heathProcessBar\").getComponent(cc.ProgressBar)\n                processBar.progress = this.health / value\n            }\n        },\n        health: {\n            get() {\n                if (this._heath == null) {\n                    this._heath = 100\n                    return this._heath\n                }\n                else {\n                    return this._heath\n                }\n            },\n            set(value) {\n                this._heath = value\n                var processBar = this.node.getChildByName(\"heathProcessBar\").getComponent(cc.ProgressBar)\n                processBar.progress = value / this.maxHealth\n            }\n        },\n        isHeathBarHidden: {\n            get() {\n                return this._isHeathBarHidden\n            },\n            set(value) {\n                this._isHeathBarHidden = value\n                var heathBarNode = this.node.getChildByName(\"heathProcessBar\")\n                \n                heathBarNode.active = value\n            }\n        },\n        moveSpeed: 100,\n\n        target: null,\n        vx: null,\n        vy: null,\n        targetIndex: 1\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n    },\n\n    start () {\n        this.node.x = this.basePathPoints[0].x\n        this.node.y = this.basePathPoints[0].y\n        this.target = this.basePathPoints[this.targetIndex]\n        var t = this.getDisOfTwoPoint(this.node.position,this.target) / this.moveSpeed\n        this.vx = (this.target.x - this.node.x) / t\n        this.vy = (this.target.y - this.node.y) / t\n\n        this.maxHealth = 100\n        this.health = 100\n    },\n\n    update (dt) {\n        if (this.state == 1) {\n            var nextX = this.node.x + this.vx * dt\n            var nextY = this.node.y + this.vy * dt\n            if (this.vx != 0) {\n                if ((nextX >= this.target.x && nextX > this.node.x) || (nextX <= this.target.x && nextX < this.node.x)) {\n                    nextX = this.target.x\n                    nextY = this.target.y\n                }\n            }\n            else {\n                if ((nextY >= this.target.y && nextY > this.node.y) || (nextY <= this.target.y && nextY < this.node.y)) {\n                    nextX = this.target.x\n                    nextY = this.target.y\n                }\n            }\n            this.node.x = nextX\n            this.node.y = nextY\n\n            if (nextX == this.target.x && nextY == this.target.y) {\n                if (this.targetIndex + 1 < this.basePathPoints.length ) {\n                    this.targetIndex += 1\n                    this.target = this.basePathPoints[this.targetIndex]\n                    var t = this.getDisOfTwoPoint(this.node.position,this.target) / this.moveSpeed\n                    this.vx = (this.target.x - this.node.x) / t\n                    this.vy = (this.target.y - this.node.y) / t\n                }\n                else {\n                    this.state = 2\n                }\n            }\n\n        }\n    },\n\n    calculatePathPoints () {\n        \n    },\n\n    getDisOfTwoPoint(p1,p2) {\n        var temp = (p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y)\n        return Math.sqrt(temp)\n    },\n\n    onReachFinalTarget() {\n        this.node.removeFromParent()\n        var mapMgr = cc.find(\"Canvas/mapNode\").getComponent(\"mapMgr\")\n        var temp = null\n        for (var index in mapMgr.monstors) {\n            if (this.node == mapMgr.monstors[index]) {\n                temp = index\n                break\n            }\n        }\n        if (temp != null) {\n            mapMgr.monstors.splice(index,1)\n        }\n    },\n\n    onDie() {\n        this.node.removeFromParent()\n        var mapMgr = cc.find(\"Canvas/mapNode\").getComponent(\"mapMgr\")\n        var temp = null\n        for (var index in mapMgr.monstors) {\n            if (this.node == mapMgr.monstors[index]) {\n                temp = index\n                break\n            }\n        }\n        if (temp != null) {\n            mapMgr.monstors.splice(index,1)\n        }\n    },\n\n    getHurt(hurtNum) {\n        var temp = this.health - hurtNum\n        if (temp <= 0) {\n            this.health = 0\n            this.state = 3\n        }\n        else {\n            this.health = temp\n        }\n    }\n});\n"]}