{"version":3,"sources":["mapMgr.js"],"names":["cc","Class","extends","Component","properties","tileMap","TiledMap","mapSize","Size","tileSize","mapSizeInPix","roadLayer","TiledLayer","pathes","monstors","onLoad","initProperties","testMonstor","find","monstorMgr","getComponent","basePathPoints","state","push","start","node","getMapSize","getTileSize","size","width","height","getLayer","pathesObjGroup","getObjectGroup","pathObjects","getObjects","index","onePathObj","position","v2","x","y","points","polylinePoints","i","onePoint","nodePosition","convertMapCodiToNodeCodi","key","name","mapOrigin","resultx","resulty","getCorrespondingPointInParraline","point1","point2","pointPara","givenPointInBaseLine","x1","y1","x2","y2","xp","yp","k","p","v"],"mappings":"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","file":"mapMgr.js","sourceRoot":"../../../../../assets/scripts/towerDefens","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tileMap: cc.TiledMap,\n        mapSize: cc.Size,\n        tileSize: cc.Size,\n        mapSizeInPix: cc.Size,\n        roadLayer: cc.TiledLayer,\n        pathes: null,\n\n        monstors: []\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.initProperties()\n        //have a test of monstor\n        var testMonstor = cc.find(\"Canvas/monstor_lvpang\")\n        var monstorMgr = testMonstor.getComponent(\"monstorMgr\")\n        monstorMgr.basePathPoints = this.pathes[\"testPath\"]\n        monstorMgr.state = 1\n        this.monstors.push(testMonstor)\n    },\n\n    start () {\n\n    },\n\n    initProperties() {\n        this.tileMap = this.node.getComponent(cc.TiledMap)\n        this.mapSize = this.tileMap.getMapSize()\n        this.tileSize = this.tileMap.getTileSize()\n        this.mapSizeInPix = cc.size(this.mapSize.width * this.tileSize.width, this.mapSize.height * this.tileSize.height)\n        this.roadLayer = this.tileMap.getLayer(\"road\")\n        var pathesObjGroup = this.tileMap.getObjectGroup(\"pathes\")\n        var pathObjects = pathesObjGroup.getObjects()\n\n        this.pathes = {}\n        for (var index in pathObjects) {\n            var onePathObj = pathObjects[index]\n            var position = cc.v2(onePathObj.x,onePathObj.y)\n            var points = onePathObj.polylinePoints\n            for (var i in points) {\n                var onePoint = points[i]\n                onePoint.x = position.x + onePoint.x\n                onePoint.y = position.y + onePoint.y\n                var nodePosition = this.convertMapCodiToNodeCodi(onePoint.x,onePoint.y)\n                onePoint.x = nodePosition.x\n                onePoint.y = nodePosition.y\n            }\n            let key = onePathObj.name\n            \n            this.pathes[key] = points\n        }\n    },\n\n    convertMapCodiToNodeCodi(x,y) {\n        var mapOrigin = cc.v2(-1 * this.mapSizeInPix.width /2 , -1 * this.mapSizeInPix.height / 2)\n        var resultx = mapOrigin.x + x\n        var resulty = mapOrigin.y + y\n        return cc.v2(resultx,resulty)\n    },\n\n    getCorrespondingPointInParraline(point1,point2,pointPara,givenPointInBaseLine) {\n        var x1 = point1.x\n        var y1 = point1.y\n        var x2 = point2.x\n        var y2 = point2.y\n        var xp = pointPara.x\n        var yp = pointPara.y\n        var x = givenPointInBaseLine.x\n        var y = givenPointInBaseLine.y\n        var resultx = null\n        var resulty = null\n        if (x2 == x1) {\n            resultx = xp\n            resulty = y\n            \n        }\n        else if (y1 == y2) {\n            resultx = x\n            resulty = yp\n            \n        }\n        else {\n            var k = (y2 - y1) / (x2 - x1)\n            var p = yp - k * xp\n            var v = y + (1 / k) * x\n            resultx = (v - p) / (k + (1 / k))\n            resulty = k * resultx + p\n        }\n        if (resultx != null && resulty != null) {\n            return cc.v2(resultx,resulty)\n        }\n        else {\n            return null\n        }\n    }\n\n    // update (dt) {},\n});\n"]}