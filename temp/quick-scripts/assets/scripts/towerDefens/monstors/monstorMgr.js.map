{"version":3,"sources":["monstorMgr.js"],"names":["cc","Class","extends","Component","properties","basePathPoints","state","get","_state","set","value","animComp","node","getComponent","Animation","play","onReachFinalTarget","moveSpeed","vx","vy","targetIndex","gameMgr","onLoad","start","x","y","target","t","getDisOfTwoPoint","position","find","update","dt","nextX","nextY","length","calculatePathPoints","p1","p2","temp","Math","sqrt","index","alivedMonstors","splice","alivedMonstorsNum","removeFromParent","heathMinusNum","currentHp","onDie","anime","animState","duration","self","tween","delay","call"],"mappings":"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","file":"monstorMgr.js","sourceRoot":"../../../../../../assets/scripts/towerDefens/monstors","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        basePathPoints: [],\n        state: {\n            get() {\n                return this._state\n            },\n            set(value) {\n                this._state = value\n                if (value == 1) {\n                    var animComp = this.node.getComponent(cc.Animation)\n                    animComp.play(\"walk\")\n                }\n                else if (value == 2) {\n                    this.onReachFinalTarget()\n                }\n                else if (value == 3) {\n\n                }\n            }\n        //STATE ENUM\n        //0 default , do nothing\n        //1 go to target\n        //2 reach final target\n        //3 die\n        //4 battle\n        },\n\n        moveSpeed: 100,\n        vx: null,\n        vy: null,\n        targetIndex: 1,\n        gameMgr: null,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n    },\n\n    start () {\n        this.node.x = this.basePathPoints[0].x\n        this.node.y = this.basePathPoints[0].y\n        this.target = this.basePathPoints[this.targetIndex]\n        var t = this.getDisOfTwoPoint(this.node.position,this.target) / this.moveSpeed\n        this.vx = (this.target.x - this.node.x) / t\n        this.vy = (this.target.y - this.node.y) / t\n\n        this.gameMgr = cc.find(\"Canvas/gameMgrNode\").getComponent(\"gameMgr\")\n        this.state = 1\n    },\n\n    update (dt) {\n        if (this.state == 1) {\n            var nextX = this.node.x + this.vx * dt\n            var nextY = this.node.y + this.vy * dt\n            if (this.vx != 0) {\n                if ((nextX >= this.target.x && nextX > this.node.x) || (nextX <= this.target.x && nextX < this.node.x)) {\n                    nextX = this.target.x\n                    nextY = this.target.y\n                }\n            }\n            else {\n                if ((nextY >= this.target.y && nextY > this.node.y) || (nextY <= this.target.y && nextY < this.node.y)) {\n                    nextX = this.target.x\n                    nextY = this.target.y\n                }\n            }\n            this.node.x = nextX\n            this.node.y = nextY\n\n            if (nextX == this.target.x && nextY == this.target.y) {\n                if (this.targetIndex + 1 < this.basePathPoints.length ) {\n                    this.targetIndex += 1\n                    this.target = this.basePathPoints[this.targetIndex]\n                    var t = this.getDisOfTwoPoint(this.node.position,this.target) / this.moveSpeed\n                    this.vx = (this.target.x - this.node.x) / t\n                    this.vy = (this.target.y - this.node.y) / t\n                }\n                else {\n                    this.state = 2\n                }\n            }\n        }\n    },\n\n    calculatePathPoints () {\n        \n    },\n\n    getDisOfTwoPoint(p1,p2) {\n        var temp = (p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y)\n        return Math.sqrt(temp)\n    },\n\n    onReachFinalTarget() {\n        \n        var temp = null\n        for (var index in this.gameMgr.alivedMonstors) {\n            if (this.node == this.gameMgr.alivedMonstors[index]) {\n                temp = index\n                break\n            }\n        }\n        if (temp != null) {\n            this.gameMgr.alivedMonstors.splice(index,1)\n            this.gameMgr.alivedMonstorsNum = this.gameMgr.alivedMonstors.length\n        }\n        this.node.removeFromParent()\n        \n        var heathMinusNum = 1\n        this.gameMgr.currentHp -= heathMinusNum\n    },\n\n    onDie() {\n        this.state = 3\n        var temp = null\n        for (var index in this.gameMgr.alivedMonstors) {\n            if (this.node == this.gameMgr.alivedMonstors[index]) {\n                temp = index\n                break\n            }\n        }\n        if (temp != null) {\n            this.gameMgr.alivedMonstors.splice(index,1)\n            this.gameMgr.alivedMonstorsNum = this.gameMgr.alivedMonstors.length\n        }\n\n        var anime = this.node.getComponent(cc.Animation)\n        var animState = anime.play(\"die\")\n        var duration = animState.duration\n        var self = this\n        cc.tween(this.node)\n            .delay(duration)\n            .call(function(){\n                self.node.removeFromParent()\n            })\n            .start()\n    },\n\n});\n"]}