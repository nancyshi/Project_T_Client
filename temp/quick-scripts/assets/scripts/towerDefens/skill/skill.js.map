{"version":3,"sources":["skill.js"],"names":["Skill","cc","Class","properties","id","Integer","skillType","hurtType","owner","Node","ownerMgr","targets","releaseSkill","config","require","toString","skillConfig","animationName","animComp","getComponent","Animation","play","error","produceResult","sendBullet","bulletResId","bulletResourceId","bulletPrefab","find","reses","prefabName","offsetX","offsetY","moveSpeed","index","target","bullet","instantiate","bulletMgr","delegate","x","y","addChild","onHit","hurtEffectResourceId","hurtEffectPrefab","hurtEffect","hurtEffectOffsetX","hurtEffectOffsetY","hurtCoefficient","additionalBuffId","battleElementMgr","hurtNum","hurt","effectedTargets","getTargetsInHurtRange","oneTarget","getHurt","getBuff","givenTarget","hurtRange","faction","length","module","exports"],"mappings":"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","file":"skill.js","sourceRoot":"../../../../../../assets/scripts/towerDefens/skill","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nvar Skill =  cc.Class({\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        id: cc.Integer,\n        skillType: 1, //while 1 indicate initiative skill , and 2 is passivity skill\n        hurtType: 1, //1 is physical , 2 is magical\n        owner: cc.Node,\n        ownerMgr: null,\n        targets: []\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    // start () {\n\n    // },\n\n    releaseSkill() {\n        var config = require(\"skillConfig\")[this.id.toString()]\n        this.skillType = config.skillType\n        if (this.skillType == 1) {\n            var skillConfig = require(\"skillConfig\")[this.id.toString()]\n            var animationName = skillConfig.animationName\n            var animComp = this.owner.getComponent(cc.Animation)\n            if (animationName != null && animationName != \"\") {\n                animComp.play(animationName)\n            }\n            else{\n                cc.error(\"not invalid animation name\")\n            }\n        }\n        else if (this.skillType == 2) {\n            this.produceResult()\n        }\n\n    },\n    sendBullet() {\n        var skillConfig = require(\"skillConfig\")[this.id.toString()]\n        var bulletResId = skillConfig.bulletResourceId\n        var bulletPrefab = cc.find(\"Canvas/resNode\").getComponent(\"resMgr\").reses[bulletResId.toString()].prefabName\n\n        var offsetX = skillConfig.offsetX\n        var offsetY = skillConfig.offsetY\n        var moveSpeed = skillConfig.moveSpeed\n\n        for (var index in this.targets) {\n            var target = this.targets[index]\n            var bullet = cc.instantiate(bulletPrefab)\n            var bulletMgr = bullet.getComponent(\"bulletMgr\")\n            bulletMgr.delegate = this\n            bulletMgr.moveSpeed = moveSpeed\n            bulletMgr.target = target\n    \n            bullet.x = offsetX + this.owner.x\n            bullet.y = offsetY + this.owner.y\n            cc.find(\"Canvas\").addChild(bullet)\n        }\n    },\n    onHit() {\n        var skillConfig = require(\"skillConfig\")[this.id.toString()]\n        var hurtEffectResourceId = skillConfig.hurtEffectResourceId\n        if (hurtEffectResourceId != \"\") {\n            var hurtEffectPrefab = cc.find(\"Canvas/resNode\").getComponent(\"resMgr\").reses[hurtEffectResourceId.toString()].prefabName\n            for (var index in this.targets) {\n                var target = this.targets[index]\n                var hurtEffect = cc.instantiate(hurtEffectPrefab)\n                var offsetX = skillConfig.hurtEffectOffsetX\n                var offsetY = skillConfig.hurtEffectOffsetY\n                \n                hurtEffect.x = offsetX\n                hurtEffect.y = offsetY\n                target.addChild(hurtEffect)\n                \n                var animComp = hurtEffect.getComponent(cc.Animation)\n                animComp.play(\"getHurt\")\n            }\n        }\n        else {\n            this.produceResult()\n        }\n    },\n    \n    produceResult() {\n        var skillConfig = require(\"skillConfig\")[this.id.toString()]\n        var hurtCoefficient = skillConfig.hurtCoefficient\n        var additionalBuffId = skillConfig.additionalBuffId\n        this.hurtType = skillConfig.hurtType\n        //both tower and monstor will have the ability to release skill\n        //they will both have a commponent named \"battleElementMgr\"\n        var battleElementMgr = this.owner.getComponent(\"battleElementMgr\")\n        var hurtNum = battleElementMgr.hurt * hurtCoefficient\n        \n        for (var index in this.targets) {\n            var target = this.targets[index]\n            var effectedTargets = this.getTargetsInHurtRange(target)\n            for (var index in effectedTargets) {\n                var oneTarget = effectedTargets[index]\n                oneTarget.getComponent(\"battleElementMgr\").getHurt(hurtNum,this.hurtType)\n                oneTarget.getComponent(\"battleElementMgr\").getBuff(additionalBuffId)\n            }\n        }\n    }, \n\n    getTargetsInHurtRange(givenTarget) {\n        var hurtRange = require(\"skillConfig\")[this.id.toString()].hurtRange\n        var faction = require(\"skillConfig\")[this.id.toString()].faction\n        var targets = this.ownerMgr.getTargetsInHurtRange(givenTarget,hurtRange,faction)\n        if (targets.length > 0) {\n            return targets\n        }\n        else {\n            cc.error(\"NO TARGET IN HURT RANGE\")\n            return null\n        }\n    }\n    // update (dt) {},\n});\n\n\nmodule.exports = Skill\n"]}