{"version":3,"sources":["gameMgr.js"],"names":["cc","Class","extends","Component","properties","refreshPlanId","get","_refreshPlanId","set","value","refreshPlan","require","toString","currentWaveIndex","_currentWaveIndex","onWaveIndexChange","currentMonstorIndex","_currentMonstorIndex","onMonstorIndexChange","resMgr","mapMgr","wavesNum","num","Object","keys","length","monstorsNumOfCurrentWave","monstorsConfig","alivedMonstors","alivedMonstorsNum","_alivedMonstorsNum","onMonstorsOfCurrentWaveCleared","maxHp","currentHp","_currentHp","hpLabel","string","onFail","waveLabel","Label","start","find","getComponent","update","dt","monstorTimer_Target","monstorTimer_Current","waveTimer_Target","waveTimer_Current","startRefresh","monstorConfig","monstorId","prefab","getMonstorPrefabById","monstor","instantiate","pathId","timeDelta","x","y","push","monstorMgr","basePathPoints","pathes","addChild","self","scheduleOnce","onMonstorsOfCurrentWaveRefreshComplete","waveDelta","onWin","givenId","reses","monstors","director","pause","log"],"mappings":"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","file":"gameMgr.js","sourceRoot":"../../../../../assets/scripts/towerDefens","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        refreshPlanId: {\n            get() {\n                return this._refreshPlanId\n            },\n            set(value) {\n                this._refreshPlanId = value\n                this.refreshPlan = require(\"refreshConfig\")[this.refreshPlanId.toString()]\n            }\n        },\n        refreshPlan: null,\n        currentWaveIndex: {\n            get() {\n                return this._currentWaveIndex\n            },\n            set(value) {\n                this._currentWaveIndex = value\n                this.onWaveIndexChange()\n            }\n        },\n        currentMonstorIndex: {\n            get() {\n                return this._currentMonstorIndex \n            },\n            set(value) {\n                this._currentMonstorIndex = value\n                this.onMonstorIndexChange()\n            }\n        },\n\n        resMgr: null,\n        mapMgr: null,\n\n        wavesNum: {\n            get(){\n                var num = null\n                if (this.refreshPlan != null) {\n                    num = Object.keys(this.refreshPlan).length\n                }\n                return num\n            }\n        },\n\n        monstorsNumOfCurrentWave: {\n            get() {\n                var num = null\n                if (this.refreshPlan != null) {\n                    //num = Object.keys(this.refreshPlan[this.currentWaveIndex.toString()].monstorsConfig).length\n                    var monstorsConfig = this.refreshPlan[this.currentWaveIndex.toString()].monstorsConfig\n                    num = Object.keys(monstorsConfig).length\n                }\n                return num\n            }\n        },\n\n        alivedMonstors: [],\n        alivedMonstorsNum: {\n            get() {\n                return this._alivedMonstorsNum\n            },\n            set(value) {\n                this._alivedMonstorsNum = value\n                if (value == 0) {\n                    this.onMonstorsOfCurrentWaveCleared()\n                }\n            }\n        },\n\n        maxHp: 10,\n        currentHp: {\n            get() {\n                return this._currentHp\n            },\n            set(value) {\n                this._currentHp = value\n                this.hpLabel.string = value.toString() + \" / \" + this.maxHp.toString()\n                if (value == 0) {\n                    this.onFail()\n                }\n            }\n        },\n\n        waveLabel: cc.Label,\n        hpLabel: cc.Label\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n        if (this.refreshPlanId == null) {\n            this.refreshPlanId = 1001\n        }\n        this.resMgr = cc.find(\"Canvas/resNode\").getComponent(\"resMgr\")\n        this.mapMgr = cc.find(\"Canvas/mapNode\").getComponent(\"mapMgr\")\n        this.currentHp = this.maxHp\n    },\n\n    update (dt) {\n        if (this.monstorTimer_Target != null && this.monstorTimer_Current != null) {\n            this.monstorTimer_Current += dt\n        }\n\n        if (this.waveTimer_Target != null && this.waveTimer_Current != null) {\n            this.waveTimer_Current += dt\n        }\n    },\n\n    startRefresh() {\n        this.currentWaveIndex = 1\n    },\n\n    onWaveIndexChange() {\n        this.waveLabel.string = this.currentWaveIndex.toString() + \" / \" + this.wavesNum.toString()\n        this.currentMonstorIndex = 1\n    },\n\n    onMonstorIndexChange() {\n        var monstorConfig = this.refreshPlan[this.currentWaveIndex.toString()].monstorsConfig[this.currentMonstorIndex.toString()]\n        var monstorId = monstorConfig.monstorId\n        var prefab = this.getMonstorPrefabById(monstorId)\n        var monstor = cc.instantiate(prefab)\n        var pathId = monstorConfig.pathId\n        var timeDelta = monstorConfig.timeDelta\n\n        monstor.x = -1000\n        monstor.y = -1000\n        this.alivedMonstors.push(monstor)\n        this.alivedMonstorsNum = this.alivedMonstors.length\n        \n        var monstorMgr = monstor.getComponent(\"monstorMgr\")\n        monstorMgr.basePathPoints = this.mapMgr.pathes[pathId.toString()]\n\n        cc.find(\"Canvas\").addChild(monstor)\n        if (this.currentMonstorIndex < this.monstorsNumOfCurrentWave) {\n            var self = this\n            this.scheduleOnce(function(){\n                self.currentMonstorIndex += 1\n            },timeDelta)\n        }\n        else {\n            this.onMonstorsOfCurrentWaveRefreshComplete()\n        }\n    },\n\n    onMonstorsOfCurrentWaveRefreshComplete() {\n\n    },\n\n    onMonstorsOfCurrentWaveCleared(){\n        if (this.currentWaveIndex < this.wavesNum) {\n            var waveDelta = this.refreshPlan[this.currentWaveIndex.toString()].waveDelta\n            var self = this\n            this.scheduleOnce(function(){\n                self.currentWaveIndex += 1\n            },waveDelta)\n        }\n\n        else {\n            this.onWin()\n        }\n    },\n\n    getMonstorPrefabById(givenId) {\n        return this.resMgr.reses.monstors[givenId.toString()]\n    },\n\n    onWin() {\n\n    },\n\n    onFail() {\n        cc.director.pause()\n        cc.log(\"YOU LOSE\")\n    }\n\n});\n"]}