{"version":3,"sources":["buildTowerUIMgr.js"],"names":["cc","Class","extends","Component","properties","buttonsConfig","btnPrefab","Prefab","gameMgr","onLoad","find","getComponent","start","enabledTowerIds","index","towerId","btnIndex","parseInt","btnName","toString","btn","node","getChildByName","Button","clickEventHandler","EventHandler","target","component","handler","customEventData","clickEvents","push","buildTower","event","towerConfig","require","oneTowerConfig","towerLevel","towerObj","buildExpand","buildExpend","currentResourceNum","resourceNum","resId","prefab","reses","prefabName","tower","instantiate","x","parent","y","towerMgr","skills","battleElementMgr","hurt","parentNode","removeUI","tween","window","delay","call","removeFromParent","addChild","update","dt"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,uBAAe,IAhBP;AAiBRC,mBAAUN,GAAGO,MAjBL;AAkBRC,iBAAS;AAlBD,KAHP;;AAwBL;;AAEAC,UA1BK,oBA0BK;AACN,aAAKD,OAAL,GAAeR,GAAGU,IAAH,CAAQ,oBAAR,EAA8BC,YAA9B,CAA2C,SAA3C,CAAf;AACH,KA5BI;AA8BLC,SA9BK,mBA8BI;AACL,YAAIC,kBAAkBb,GAAGU,IAAH,CAAQ,gBAAR,EAA0BC,YAA1B,CAAuC,QAAvC,EAAiDE,eAAvE;AACA,aAAI,IAAIC,KAAR,IAAiBD,eAAjB,EAAkC;AAC9B,gBAAIE,UAAUF,gBAAgBC,KAAhB,CAAd;AACA,gBAAIE,WAAWC,SAASH,KAAT,IAAkB,CAAjC;AACA,gBAAII,UAAU,UAAUF,SAASG,QAAT,EAAxB;;AAEA,gBAAIC,MAAM,KAAKC,IAAL,CAAUC,cAAV,CAAyBJ,OAAzB,EAAkCP,YAAlC,CAA+CX,GAAGuB,MAAlD,CAAV;;AAEA,gBAAIC,oBAAoB,IAAIxB,GAAGG,SAAH,CAAasB,YAAjB,EAAxB;AACAD,8BAAkBE,MAAlB,GAA2B,KAAKL,IAAhC;AACAG,8BAAkBG,SAAlB,GAA8B,iBAA9B;AACAH,8BAAkBI,OAAlB,GAA4B,YAA5B;AACAJ,8BAAkBK,eAAlB,GAAoCd,OAApC;;AAEAK,gBAAIU,WAAJ,CAAgBC,IAAhB,CAAqBP,iBAArB;AACH;AACJ,KA/CI;AAiDLQ,cAjDK,sBAiDMC,KAjDN,EAiDYlB,OAjDZ,EAiDqB;AACtB,YAAImB,cAAcC,QAAQ,aAAR,CAAlB;AACA,YAAIC,iBAAiBF,YAAYnB,QAAQI,QAAR,EAAZ,CAArB;AACA,YAAIkB,aAAa,CAAjB,CAHsB,CAGH;AACnB,YAAIC,WAAWF,eAAeC,WAAWlB,QAAX,EAAf,CAAf;AACA,YAAIoB,cAAcD,SAASE,WAA3B;;AAEA,YAAIC,qBAAqB,KAAKjC,OAAL,CAAakC,WAAtC;AACA,YAAIH,cAAcE,kBAAlB,EAAsC;AAClC;AACH;;AAED,aAAKjC,OAAL,CAAakC,WAAb,IAA6BH,WAA7B;AACA,YAAII,QAAQL,SAASK,KAArB;AACA,YAAIC,SAAS5C,GAAGU,IAAH,CAAQ,gBAAR,EAA0BC,YAA1B,CAAuC,QAAvC,EAAiDkC,KAAjD,CAAuDF,MAAMxB,QAAN,EAAvD,EAAyE2B,UAAtF;;AAEA,YAAIC,QAAQ/C,GAAGgD,WAAH,CAAeJ,MAAf,CAAZ;AACAG,cAAME,CAAN,GAAU,KAAK5B,IAAL,CAAU6B,MAAV,CAAiBD,CAA3B;AACAF,cAAMI,CAAN,GAAU,KAAK9B,IAAL,CAAU6B,MAAV,CAAiBC,CAA3B;;AAEA,YAAIC,WAAWL,MAAMpC,YAAN,CAAmB,UAAnB,CAAf;AACAyC,iBAASC,MAAT,GAAkBf,SAASe,MAA3B;;AAEA,YAAIC,mBAAmBP,MAAMpC,YAAN,CAAmB,kBAAnB,CAAvB;AACA2C,yBAAiBC,IAAjB,GAAwBjB,SAASiB,IAAjC;;AAEA,YAAIC,aAAa,KAAKnC,IAAL,CAAU6B,MAA3B;AACA,aAAK7B,IAAL,CAAU6B,MAAV,CAAiBvC,YAAjB,CAA8B,cAA9B,EAA8C8C,QAA9C;;AAEAzD,WAAG0D,KAAH,CAASC,MAAT,EACKC,KADL,CACW,GADX,EAEKC,IAFL,CAEU,YAAU;AACZL,uBAAWM,gBAAX;AACA9D,eAAGU,IAAH,CAAQ,QAAR,EAAkBqD,QAAlB,CAA2BhB,KAA3B;AACH,SALL,EAMKnC,KANL;AAOH,KArFI;AAuFLoD,UAvFK,kBAuFGC,EAvFH,EAuFO,CAEX;AAzFI,CAAT","file":"buildTowerUIMgr.js","sourceRoot":"../../../../../../assets/scripts/towerDefens/towers","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        buttonsConfig: null,\n        btnPrefab:cc.Prefab,\n        gameMgr: null,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.gameMgr = cc.find(\"Canvas/gameMgrNode\").getComponent(\"gameMgr\")\n    },\n\n    start () {\n        var enabledTowerIds = cc.find(\"Canvas/resNode\").getComponent(\"resMgr\").enabledTowerIds\n        for(var index in enabledTowerIds) {\n            var towerId = enabledTowerIds[index]\n            var btnIndex = parseInt(index) + 1\n            var btnName = \"btn_0\" + btnIndex.toString()\n\n            var btn = this.node.getChildByName(btnName).getComponent(cc.Button)\n\n            var clickEventHandler = new cc.Component.EventHandler()\n            clickEventHandler.target = this.node\n            clickEventHandler.component = \"buildTowerUIMgr\"\n            clickEventHandler.handler = \"buildTower\"\n            clickEventHandler.customEventData = towerId\n\n            btn.clickEvents.push(clickEventHandler)\n        }\n    },\n\n    buildTower(event,towerId) {\n        var towerConfig = require(\"towerConfig\")\n        var oneTowerConfig = towerConfig[towerId.toString()]\n        var towerLevel = 1 //for now use a fixed level\n        var towerObj = oneTowerConfig[towerLevel.toString()]\n        var buildExpand = towerObj.buildExpend\n\n        var currentResourceNum = this.gameMgr.resourceNum\n        if (buildExpand > currentResourceNum) {\n            return\n        }\n        \n        this.gameMgr.resourceNum  -= buildExpand\n        var resId = towerObj.resId\n        var prefab = cc.find(\"Canvas/resNode\").getComponent(\"resMgr\").reses[resId.toString()].prefabName\n        \n        var tower = cc.instantiate(prefab)\n        tower.x = this.node.parent.x\n        tower.y = this.node.parent.y\n\n        var towerMgr = tower.getComponent(\"towerMgr\")\n        towerMgr.skills = towerObj.skills\n\n        var battleElementMgr = tower.getComponent(\"battleElementMgr\")\n        battleElementMgr.hurt = towerObj.hurt\n\n        var parentNode = this.node.parent\n        this.node.parent.getComponent(\"towerAreaMgr\").removeUI()\n        \n        cc.tween(window)\n            .delay(0.2)\n            .call(function(){\n                parentNode.removeFromParent()\n                cc.find(\"Canvas\").addChild(tower)\n            })\n            .start()\n    },\n\n    update (dt) {\n\n    },\n});\n"]}