{"version":3,"sources":["effectMgr.js"],"names":["cc","Class","extends","Component","properties","target","Node","moveSpeed","effectType","hurtEffectPrefab","Prefab","delegate","start","manager","director","getCollisionManager","enabled","update","dt","getComponent","state","node","removeFromParent","direction","v2","position","x","y","normalizeSelf","vx","vy","angle","signAngle","degree","Math","PI","onCollisionEnter","other","self","effect","instantiate","effectMgr","addChild","_acturalHurt","acturalHurt"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,gBAAQL,GAAGM,IADH;AAERC,mBAAW,GAFH;AAGRC,oBAAY,CAHJ,EAGO;AACfC,0BAAkBT,GAAGU,MAJb;AAKRC,kBAAU;AALF,KAHP;;AAWL;;AAEA;;AAEAC,SAfK,mBAeI;AACL,YAAI,KAAKJ,UAAL,IAAmB,CAAvB,EAA0B;AACtB,gBAAIK,UAAUb,GAAGc,QAAH,CAAYC,mBAAZ,EAAd;AACAF,oBAAQG,OAAR,GAAkB,IAAlB;AACH;AACJ,KApBI;AAsBLC,UAtBK,kBAsBGC,EAtBH,EAsBO;AACR,YAAI,KAAKV,UAAL,IAAmB,CAAvB,EAA0B;AACtB,gBAAI,KAAKH,MAAL,CAAYc,YAAZ,CAAyB,YAAzB,EAAuCC,KAAvC,IAAgD,CAApD,EAAuD;AACnD,qBAAKC,IAAL,CAAUC,gBAAV;AACH,aAFD,MAGK;AACD,oBAAIC,YAAYvB,GAAGwB,EAAH,CAAM,KAAKnB,MAAL,CAAYoB,QAAZ,CAAqBC,CAArB,GAAyB,KAAKL,IAAL,CAAUK,CAAzC,EAA4C,KAAKrB,MAAL,CAAYoB,QAAZ,CAAqBE,CAArB,GAAyB,KAAKN,IAAL,CAAUM,CAA/E,EAAkFC,aAAlF,EAAhB;AACA,oBAAIC,KAAKN,UAAUG,CAAV,GAAc,KAAKnB,SAA5B;AACA,oBAAIuB,KAAKP,UAAUI,CAAV,GAAc,KAAKpB,SAA5B;AACA,qBAAKc,IAAL,CAAUK,CAAV,GAAc,KAAKL,IAAL,CAAUK,CAAV,GAAcG,KAAKX,EAAjC;AACA,qBAAKG,IAAL,CAAUM,CAAV,GAAc,KAAKN,IAAL,CAAUM,CAAV,GAAcG,KAAKZ,EAAjC;;AAEA,oBAAIa,QAAQR,UAAUS,SAAV,CAAoBhC,GAAGwB,EAAH,CAAM,CAAN,EAAQ,CAAR,CAApB,CAAZ;AACA,oBAAIS,SAASF,QAAQG,KAAKC,EAAb,GAAkB,GAA/B;AACA,qBAAKd,IAAL,CAAUU,KAAV,GAAkB,CAAC,CAAD,GAAKE,MAAvB;AACH;AACJ;AACJ,KAvCI;AAwCLG,oBAxCK,4BAwCYC,KAxCZ,EAwCkBC,IAxClB,EAwCwB;AACzB;AACA,YAAID,MAAMhB,IAAN,IAAc,KAAKhB,MAAvB,EAA+B;AAC3B,gBAAI,KAAKI,gBAAL,IAAyB,IAA7B,EAAmC;AAC/B,oBAAI8B,SAASvC,GAAGwC,WAAH,CAAe,KAAK/B,gBAApB,CAAb;AACA,oBAAIgC,YAAYF,OAAOpB,YAAP,CAAoB,WAApB,CAAhB;AACAsB,0BAAUpC,MAAV,GAAmB,KAAKA,MAAxB;AACAoC,0BAAUjC,UAAV,GAAuB,CAAvB;AACAiC,0BAAU9B,QAAV,GAAqB,KAAKA,QAA1B;AACA,qBAAKN,MAAL,CAAYqC,QAAZ,CAAqBH,MAArB;AACH,aAPD,MAQK;AACD,qBAAK5B,QAAL,CAAcgC,YAAd,CAA2B,KAAKtC,MAAhC;AACH;AACD,iBAAKgB,IAAL,CAAUC,gBAAV;AACH;AACJ,KAxDI;AAyDLsB,eAzDK,yBAyDS;AACV,aAAKjC,QAAL,CAAcgC,YAAd,CAA2B,KAAKtC,MAAhC;AACH;AA3DI,CAAT","file":"effectMgr.js","sourceRoot":"../../../../../assets/scripts/towerDefens","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        target: cc.Node,\n        moveSpeed: 500,\n        effectType: 1, //1 indicate that it's a bullet effect\n        hurtEffectPrefab: cc.Prefab,\n        delegate: null\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n        if (this.effectType == 1) {\n            var manager = cc.director.getCollisionManager()\n            manager.enabled = true            \n        }\n    },\n\n    update (dt) {\n        if (this.effectType == 1) {\n            if (this.target.getComponent(\"monstorMgr\").state == 3) {\n                this.node.removeFromParent()\n            }\n            else {\n                var direction = cc.v2(this.target.position.x - this.node.x, this.target.position.y - this.node.y).normalizeSelf()\n                var vx = direction.x * this.moveSpeed\n                var vy = direction.y * this.moveSpeed\n                this.node.x = this.node.x + vx * dt\n                this.node.y = this.node.y + vy * dt\n                \n                var angle = direction.signAngle(cc.v2(1,0))\n                var degree = angle / Math.PI * 180\n                this.node.angle = -1 * degree\n            }\n        }\n    },\n    onCollisionEnter(other,self) {\n        //only bullet effect can triger this method\n        if (other.node == this.target) {\n            if (this.hurtEffectPrefab != null) {\n                var effect = cc.instantiate(this.hurtEffectPrefab)\n                var effectMgr = effect.getComponent(\"effectMgr\")\n                effectMgr.target = this.target\n                effectMgr.effectType = 2\n                effectMgr.delegate = this.delegate\n                this.target.addChild(effect)\n            }\n            else {\n                this.delegate._acturalHurt(this.target)\n            }\n            this.node.removeFromParent()\n        }\n    },\n    acturalHurt() {\n        this.delegate._acturalHurt(this.target)\n    }\n    \n});\n"]}