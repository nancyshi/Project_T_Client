{"version":3,"sources":["dataMgr.js"],"names":["dataMgr","cc","Class","properties","playerData","get","_playerData","set","value","onPlayerDataUpdated","updatePlayerDataFromServer","playerId","networkMgr","require","msgObj","makeMessageObj","message","self","successCallBack","xhr","response","responseText","JSON","parse","type","sendMessageByMsgObj","log","stringify","commitPlayerDataToServer","dataForCommit","id","commitBody","shareDataMgr","module","exports"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIA,UAAUC,GAAGC,KAAH,CAAS;;AAGnBC,gBAAY;;AAERC,oBAAY;AACRC,eADQ,iBACF;AACF,uBAAO,KAAKC,WAAZ;AACH,aAHO;AAIRC,eAJQ,eAIJC,KAJI,EAIG;AACP,qBAAKF,WAAL,GAAmBE,KAAnB;AACA,qBAAKC,mBAAL;AACA;AACH;AARO;;AAFJ,KAHO;;AAkBnBC,8BAlBmB,sCAkBQC,QAlBR,EAkBkB;;AAEjC,YAAIC,aAAaC,QAAQ,YAAR,CAAjB;AACA,YAAIC,SAASF,WAAWG,cAAX,CAA0B,YAA1B,EAAuC,kBAAvC,CAAb;AACAD,eAAOE,OAAP,CAAeL,QAAf,GAA0BA,QAA1B;AACA,YAAIM,OAAO,IAAX;AACAH,eAAOI,eAAP,GAAyB,UAASC,GAAT,EAAc;AACnC,gBAAIC,WAAWD,IAAIE,YAAnB;AACAD,uBAAWE,KAAKC,KAAL,CAAWH,QAAX,CAAX;AACA,gBAAIA,SAASI,IAAT,IAAiB,SAArB,EAAgC;AAC5BP,qBAAKb,UAAL,GAAkBgB,SAAShB,UAA3B;AACH,aAFD,MAGK;AACD;AACH;AACJ,SATD;AAUAQ,mBAAWa,mBAAX,CAA+BX,MAA/B;AACH,KAnCkB;AAoCnBL,uBApCmB,iCAoCI;AACnBR,WAAGyB,GAAH,CAAO,wBAAwBJ,KAAKK,SAAL,CAAe,KAAKvB,UAApB,CAA/B;AACH,KAtCkB;AAwCnBwB,4BAxCmB,oCAwCMC,aAxCN,EAwCqB;AACpC,YAAIjB,aAAaC,QAAQ,YAAR,CAAjB;AACA,YAAIC,SAASF,WAAWG,cAAX,CAA0B,YAA1B,EAAuC,kBAAvC,CAAb;AACAD,eAAOE,OAAP,CAAeL,QAAf,GAA0B,KAAKP,UAAL,CAAgB0B,EAA1C;AACA,YAAIhB,OAAOE,OAAP,CAAeL,QAAf,IAA2B,IAA/B,EAAqC;AACjCV,eAAGyB,GAAH,CAAO,gBAAP;AACA;AACH;;AAEDZ,eAAOE,OAAP,CAAee,UAAf,GAA4BF,aAA5B;AACAjB,mBAAWa,mBAAX,CAA+BX,MAA/B;AACH;AAnDkB,CAAT,CAAd;;AAsDA,IAAIkB,eAAe,IAAIhC,OAAJ,EAAnB;AACAiC,OAAOC,OAAP,GAAiBF,YAAjB","file":"dataMgr.js","sourceRoot":"../../../../../assets/scripts/libs","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nvar dataMgr = cc.Class({\n    \n\n    properties: {\n\n        playerData: {\n            get() {\n                return this._playerData\n            },\n            set(value) {\n                this._playerData = value\n                this.onPlayerDataUpdated()\n                //do something else\n            }\n        }\n        \n    },\n\n    updatePlayerDataFromServer(playerId) {\n\n        var networkMgr = require(\"networkMgr\")\n        var msgObj = networkMgr.makeMessageObj(\"dataModule\",\"queryMessageType\")\n        msgObj.message.playerId = playerId\n        var self = this\n        msgObj.successCallBack = function(xhr) {\n            var response = xhr.responseText\n            response = JSON.parse(response)  \n            if (response.type == \"success\") {\n                self.playerData = response.playerData\n            }\n            else {\n                //do something for erros\n            }\n        }\n        networkMgr.sendMessageByMsgObj(msgObj)\n    },\n    onPlayerDataUpdated () {\n        cc.log(\"now player data is \" + JSON.stringify(this.playerData))\n    },\n\n    commitPlayerDataToServer(dataForCommit) {\n        var networkMgr = require(\"networkMgr\")\n        var msgObj = networkMgr.makeMessageObj(\"dataModule\",\"commitMessageTyp\")\n        msgObj.message.playerId = this.playerData.id\n        if (msgObj.message.playerId == null) {\n            cc.log(\"no player data\")\n            return\n        }\n        \n        msgObj.message.commitBody = dataForCommit\n        networkMgr.sendMessageByMsgObj(msgObj)\n    }\n});\n\nvar shareDataMgr = new dataMgr()\nmodule.exports = shareDataMgr\n"]}